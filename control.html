<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de Ruleta</title>
<style>
body{font-family:Arial;padding:30px}
input{width:100%;padding:10px;margin-bottom:10px;font-size:16px}
button{padding:10px 15px;border:none;border-radius:8px;cursor:pointer}
.add{background:#4CAF50;color:#fff}
.spin{background:#ff3d7f;color:#fff;font-size:18px;margin-top:15px}
.clear{background:#333;color:#fff;margin-left:10px}
.item{
  background:#ffe4ef;
  padding:8px 12px;
  margin:6px 0;
  border-radius:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.delete{
  background:#ff4d6d;
  color:white;
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
}
.preset{
  background:#2196F3;
  color:#fff;
  padding:8px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
}
</style>
</head>
<body>

<h1>ğŸ° Control de Ruleta</h1>

<label>Texto del item</label>
<input id="texto" placeholder="Ej: 5 Gifted Subs">

<button class="add" onclick="agregar()">â• Agregar</button>

<h3>ğŸš« Excluir items del sorteo:</h3>
<div style="margin-bottom:10px">
  <label>Item 1 a excluir:</label>
  <select id="excluir1" style="width:100%;padding:10px;font-size:16px;margin-bottom:5px;border-radius:8px;">
    <option value="">-- Ninguno --</option>
  </select>
  
  <label>Item 2 a excluir:</label>
  <select id="excluir2" style="width:100%;padding:10px;font-size:16px;margin-bottom:10px;border-radius:8px;">
    <option value="">-- Ninguno --</option>
  </select>
</div>
<button class="spin" onclick="girarConExclusiones()">ğŸ² GIRAR CON EXCLUSIONES</button>

<h3>Listas predefinidas:</h3>
<div style="margin:15px 0;display:flex;gap:10px;flex-wrap:wrap">
  <button class="preset" onclick="cargarKillersOriginales()">ğŸ‘» Killers Originales</button>
  <button class="preset" onclick="cargarKillersLicenciados()">ğŸ¬ Killers Licenciados</button>
  <button class="preset" onclick="cargarKillersComunidad()">ğŸŒŸ Killers Comunidad</button>
  <button class="preset" onclick="cargarTodos()">ğŸ“‹ Todos los Killers</button>
  <button class="preset" onclick="cargarPerks()">ğŸ’ Ventajas (Perks)</button>
  <button class="preset" onclick="cargarPartidas()">ğŸ® Partidas</button>
  <button class="preset" onclick="cargarNombres()">ğŸ‘¤ Nombres</button>
</div>

<h3>Items en la ruleta:</h3>
<div id="lista"></div>

<button class="spin" onclick="girar()">ğŸ² GIRAR RULETA</button>
<button class="clear" onclick="limpiar()">ğŸ—‘ Limpiar todo</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCxo_ndD5H5UM-q-qRA2jlikT8kXuvqEKA",
  authDomain: "obs-barra.firebaseapp.com",
  databaseURL: "https://obs-barra-default-rtdb.firebaseio.com",
  projectId: "obs-barra",
  storageBucket: "obs-barra.firebasestorage.app",
  messagingSenderId: "515697971120",
  appId: "1:515697971120:web:6cd07a5f10c46feef85075"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let premios = [];

// Listas predefinidas de killers
const killersOriginales = [
  "El Trampero",
  "El Espectro",
  "El Pueblerino",
  "La Enfermera",
  "La Bruja",
  "El Doctor",
  "La Cazadora",
  "La LegiÃ³n",
  "El Embaucador",
  "El Caballero",
  "El Xenomorfo"
];

const killersLicenciados = [
  "The Shape - Michael Myers (Halloween)",
  "The Cannibal - Leatherface (Texas Chainsaw)",
  "The Nightmare - Freddy Krueger",
  "The Pig - Amanda (SAW)",
  "The Ghost Face - Ghostface (Scream)",
  "The Demogorgon - Stranger Things",
  "The Executioner - Pyramid Head (Silent Hill)",
  "The Nemesis - Resident Evil",
  "The Mastermind - Albert Wesker (RE)",
  "The Cenobite - Pinhead (Hellraiser)",
  "The OnryÅ - Sadako (The Ring)",
  "The Xenomorph - Alien",
  "The Good Guy - Chucky (Child's Play)"
];

const killersComunidad = [
  "Springtrap - Five Nights at Freddy's",
  "The Ghoul - Ken Kaneki (Tokyo Ghoul)"
];

// Lista de perks
const perks = [
  "Presencia abrumadora",
  "Presencia perturbadora",
  "Quebrantamentes",
  "RecuÃ©rdame",
  "Rencor",
  "Reparador",
  "Resistente",
  "RestricciÃ³n cruel",
  "Sabueso de sangre",
  "Senda del tormento",
  "Sin piedad",
  "Sin restricciones",
  "Sin salida",
  "Soberbia",
  "Sobrecarga / el doctor",
  "Sobrecarga / el demogorgon",
  "Soy todo oÃ­dos",
  "SupervisiÃ³n",
  "Tanatofobia",
  "Temblores trepidantes",
  "Terminal",
  "Terror contagioso",
  "Toma una decisiÃ³n",
  "Toque lÃ¡nguido",
  "Tormento despiadado",
  "Trueno sÃ­smico",
  "TÃ¡cticas zanshin",
  "Unidos por siempre",
  "VocaciÃ³n de enfermera",
  "Voracidad",
  "Â¡Plaf!",
  "Abrazo de la muerte",
  "Acechador de ciervos",
  "Acumulador",
  "AgitaciÃ³n",
  "Aliento",
  "Amigos hasta el fin",
  "AnatomÃ­a superior",
  "Anuncio de salmuera",
  "Aprendizaje automatizado",
  "ApretÃ³n de hierro",
  "Arma definitiva",
  "ArmonizaciÃ³n de tejido",
  "Arrogancia oscura",
  "Atadura mortal",
  "BaterÃ­as incluidas",
  "Bestia de presa",
  "Brutalidad veloz",
  "Cabeza dentada",
  "Caos",
  "Carnicero chapucero",
  "Codicia humana",
  "Conciencia de estar despiertos",
  "Contacto sÃ©ptico",
  "Coulrofobia",
  "DepredaciÃ³n",
  "Desasosiego",
  "Desatado",
  "Desconcierto",
  "Deslumbrante",
  "DevociÃ³n oscura",
  "Discordancia",
  "DisoluciÃ³n",
  "DominaciÃ³n",
  "Doncella de hierro",
  "Duda forzada",
  "Eco de sangre",
  "Enfurecimiento",
  "ErupciÃ³n",
  "Esperanza rota",
  "EspÃ­as de las sombras",
  "Fuerza brutal",
  "Furia ciega",
  "Furia espiritual",
  "Gancho torturador: brÃºjula irregular",
  "Gancho torturador: dolor resonante",
  "Gancho torturador: heridas supurantes",
  "Gancho torturador: santuario monstruoso",
  "Gancho torturador: torrente de ira",
  "Gancho torturador: truco del verdugo",
  "Garra de dragÃ³n",
  "Golpe de gracia",
  "GuardiÃ¡n de sangre",
  "Hijo de la luz",
  "Hijo de las sombras",
  "Histeria",
  "Hora de la cacerÃ­a",
  "Implacable",
  "Imprevisto",
  "Inacabado",
  "Influencia",
  "Insidia",
  "Instinto alienÃ­gena",
  "Instinto territorial",
  "Interruptor de hombre muerto",
  "IntervenciÃ³n corrupta",
  "Jugar con la comida",
  "Lo mejor para el final",
  "Luz que agoniza",
  "LÃ­mites genÃ©ticos",
  "Maleficio: arrepentimiento",
  "Maleficio: arrullo de cazadora",
  "Maleficio: control del pÃºblico",
  "Maleficio: destino miserable",
  "Maleficio: devoradora de esperanza",
  "Maleficio: el bufÃ³n de la fortuna",
  "Maleficio: el tercer sello",
  "Maleficio: enfrentar a la oscuridad",
  "Maleficio: favor de sangre",
  "Maleficio: inmortal",
  "Maleficio: la emociÃ³n de la caza",
  "Maleficio: nadie escapa de la muerte",
  "Maleficio: obertura de la perdiciÃ³n",
  "Maleficio: pura miseria",
  "Maleficio: restribuciÃ³n",
  "Maleficio: ruina",
  "Maleficio: tierra embrujada",
  "Maleficio: yo tambiÃ©n puedo jugar",
  "Miedo fantasmal",
  "MonitorizaciÃ³n y abuso",
  "Muerte de franklin",
  "Murmullo amargo",
  "Murmullos",
  "Nadie es libre",
  "No hay dÃ³nde esconderse",
  "Noqueo",
  "NÃ©mesis",
  "Ojo errante",
  "OpresiÃ³n",
  "Oscuridad revelada",
  "Parrillada y chile",
  "Pedido de ayuda",
  "Penitencia forzada",
  "PersecuciÃ³n furtiva",
  "Perseguidor letal",
  "Pim pam pum"
];

const partidas = [
  "1 partida entera",
  "1 partida",
  "2 partidas",
  "3 partidas",
  "4 partidas",
  "5 partidas",
  "1 partida",
  "2 partidas",
  "1 partida",
  "1 partida"
];

const nombres = [
  "Doom",
  "Gun",
  "Dead",
  "Charlie",
  "Victor",
  "Estruvulucu",
  "King",
  "Scarleth"
];

const listaDiv = document.getElementById("lista");
const textoInput = document.getElementById("texto");
const excluir1Select = document.getElementById("excluir1");
const excluir2Select = document.getElementById("excluir2");

function guardarFirebase(){
  set(ref(db,"ruleta/premios"), premios);
}

function actualizarSelects(){
  // Actualizar ambos selects de exclusiÃ³n
  [excluir1Select, excluir2Select].forEach(select => {
    select.innerHTML = '<option value="">-- Ninguno --</option>';
    premios.forEach((p, i) => {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = p;
      select.appendChild(option);
    });
  });
}

function renderLista(){
  listaDiv.innerHTML="";
  premios.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML = `
      <span>${p}</span>
      <button class="delete" onclick="eliminar(${i})">âŒ</button>
    `;
    listaDiv.appendChild(d);
  });
  actualizarSelects();
}

window.agregar = () => {
  const t = textoInput.value.trim();
  if(!t) return;
  premios.push(t);
  textoInput.value="";
  renderLista();
  guardarFirebase();
};

window.eliminar = (index) => {
  premios.splice(index,1);
  renderLista();
  guardarFirebase();
};

window.limpiar = () => {
  premios = [];
  renderLista();
  guardarFirebase();
};

window.girar = () => {
  if(premios.length === 0){
    alert("âš ï¸ Agrega items a la ruleta primero");
    return;
  }

  // Seleccionar ganador aleatorio
  const ganador = premios[Math.floor(Math.random() * premios.length)];

  // Escribir en Firebase
  set(ref(db,"ruleta"), {
    premios: premios,
    resultado: ganador
  });
};

window.girarConExclusiones = () => {
  if(premios.length === 0){
    alert("âš ï¸ Agrega items a la ruleta primero");
    return;
  }

  const excluido1 = excluir1Select.value;
  const excluido2 = excluir2Select.value;
  
  // Validar que no sean el mismo item
  if(excluido1 !== "" && excluido1 === excluido2){
    alert("âš ï¸ Los dos items excluidos no pueden ser el mismo");
    return;
  }

  // Crear array de Ã­ndices vÃ¡lidos (sin los excluidos)
  const indicesValidos = [];
  premios.forEach((p, i) => {
    if(i.toString() !== excluido1 && i.toString() !== excluido2){
      indicesValidos.push(i);
    }
  });

  // Validar que queden al menos 1 item vÃ¡lido
  if(indicesValidos.length === 0){
    alert("âš ï¸ Debes dejar al menos un item sin excluir");
    return;
  }

  // Seleccionar ganador aleatorio de los items vÃ¡lidos
  const indiceGanador = indicesValidos[Math.floor(Math.random() * indicesValidos.length)];
  const ganador = premios[indiceGanador];

  // Escribir en Firebase
  set(ref(db,"ruleta"), {
    premios: premios,
    resultado: ganador
  });

  // Opcional: resetear los selects
  excluir1Select.value = "";
  excluir2Select.value = "";
};

window.cargarKillersOriginales = () => {
  premios = [...killersOriginales];
  renderLista();
  guardarFirebase();
};

window.cargarKillersLicenciados = () => {
  premios = [...killersLicenciados];
  renderLista();
  guardarFirebase();
};

window.cargarKillersComunidad = () => {
  premios = [...killersComunidad];
  renderLista();
  guardarFirebase();
};

window.cargarTodos = () => {
  premios = [...killersOriginales, ...killersLicenciados, ...killersComunidad];
  renderLista();
  guardarFirebase();
};

window.cargarPerks = () => {
  premios = [...perks];
  renderLista();
  guardarFirebase();
};

window.cargarPartidas = () => {
  premios = [...partidas];
  renderLista();
  guardarFirebase();
};

window.cargarNombres = () => {
  premios = [...nombres];
  renderLista();
  guardarFirebase();
};

onValue(ref(db,"ruleta/premios"), snap=>{
  if(snap.exists()){
    premios = snap.val();
    renderLista();
  }
});
</script>

</body>
</html>
