<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de Ruleta</title>
<style>
body{font-family:Arial;padding:30px}
input{width:100%;padding:10px;margin-bottom:10px;font-size:16px}
button{padding:10px 15px;border:none;border-radius:8px;cursor:pointer}
.add{background:#4CAF50;color:#fff}
.spin{background:#ff3d7f;color:#fff;font-size:18px;margin-top:15px}
.clear{background:#333;color:#fff;margin-left:10px}
.item{
  background:#ffe4ef;
  padding:8px 12px;
  margin:6px 0;
  border-radius:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.delete{
  background:#ff4d6d;
  color:white;
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
}
.preset{
  background:#2196F3;
  color:#fff;
  padding:8px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
}
</style>
</head>
<body>

<h1>ğŸ° Control de Ruleta</h1>

<label>Texto del item</label>
<input id="texto" placeholder="Ej: 5 Gifted Subs">

<button class="add" onclick="agregar()">â• Agregar</button>

<h3>ğŸš« Excluir items del sorteo:</h3>
<div style="margin-bottom:10px">
  <label>Item 1 a excluir:</label>
  <select id="excluir1" style="width:100%;padding:10px;font-size:16px;margin-bottom:5px;border-radius:8px;">
    <option value="">-- Ninguno --</option>
  </select>
  
  <label>Item 2 a excluir:</label>
  <select id="excluir2" style="width:100%;padding:10px;font-size:16px;margin-bottom:10px;border-radius:8px;">
    <option value="">-- Ninguno --</option>
  </select>
</div>
<button class="spin" onclick="girarConExclusiones()">ğŸ² GIRAR CON EXCLUSIONES</button>

<h3>Listas predefinidas:</h3>
<div style="margin:15px 0;display:flex;gap:10px;flex-wrap:wrap">
  <button class="preset" onclick="cargarKillersOriginales()">ğŸ‘» Killers Originales</button>
  <button class="preset" onclick="cargarKillersLicenciados()">ğŸ¬ Killers Licenciados</button>
  <button class="preset" onclick="cargarKillersComunidad()">ğŸŒŸ Killers Comunidad</button>
  <button class="preset" onclick="cargarTodos()">ğŸ“‹ Todos los Killers</button>
  <button class="preset" onclick="cargarPerks()">ğŸ’ Ventajas (Perks)</button>
</div>

<h3>Items en la ruleta:</h3>
<div id="lista"></div>

<button class="spin" onclick="girar()">ğŸ² GIRAR RULETA</button>
<button class="clear" onclick="limpiar()">ğŸ—‘ Limpiar todo</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCxo_ndD5H5UM-q-qRA2jlikT8kXuvqEKA",
  authDomain: "obs-barra.firebaseapp.com",
  databaseURL: "https://obs-barra-default-rtdb.firebaseio.com",
  projectId: "obs-barra",
  storageBucket: "obs-barra.firebasestorage.app",
  messagingSenderId: "515697971120",
  appId: "1:515697971120:web:6cd07a5f10c46feef85075"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let premios = [];

// Listas predefinidas de killers
const killersOriginales = [
  "The Trapper - El Trampero",
  "The Wraith - El Espectro",
  "The Hillbilly - El Paleto",
  "The Nurse - La Enfermera",
  "The Hag - La Bruja",
  "The Doctor - El Doctor",
  "The Huntress - La Cazadora",
  "The Clown - El Payaso",
  "The Spirit - El EspÃ­ritu",
  "The Legion - La LegiÃ³n",
  "The Plague - La Plaga",
  "The Oni - El Oni",
  "The Deathslinger - El Pistolero",
  "The Blight - El Marchitador",
  "The Twins - Los Gemelos",
  "The Trickster - El Artista del Truco",
  "The Artist - La Artista",
  "The Dredge - El Dragador",
  "The Knight - El Caballero",
  "The Skull Merchant - La Comerciante de Calaveras",
  "The Singularity - La Singularidad",
  "The Unknown - El Desconocido"
];

const killersLicenciados = [
  "The Shape - Michael Myers (Halloween)",
  "The Cannibal - Leatherface (Texas Chainsaw)",
  "The Nightmare - Freddy Krueger",
  "The Pig - Amanda (SAW)",
  "The Ghost Face - Ghostface (Scream)",
  "The Demogorgon - Stranger Things",
  "The Executioner - Pyramid Head (Silent Hill)",
  "The Nemesis - Resident Evil",
  "The Mastermind - Albert Wesker (RE)",
  "The Cenobite - Pinhead (Hellraiser)",
  "The OnryÅ - Sadako (The Ring)",
  "The Xenomorph - Alien",
  "The Good Guy - Chucky (Child's Play)"
];

const killersComunidad = [
  "Springtrap - Five Nights at Freddy's",
  "The Ghoul - Ken Kaneki (Tokyo Ghoul)"
];

// Lista de perks
const perks = [
  // Hex Perks
  "Hex: Nadie Escapa de la Muerte (NOED)",
  "Hex: Ruina",
  "Hex: Devora Esperanza",
  "Hex: Terreno Embrujado",
  "Hex: Lullaby de la Cazadora",
  "Hex: EmociÃ³n de la Caza",
  "Hex: Control de Multitudes",
  "Hex: Pentimento",
  "Hex: Indestructible (Undying)",
  "Hex: Enfrentar la Oscuridad",
  "Hex: Destino Retorcido",
  "Hex: Dos Pueden Jugar",
  "Hex: Nada MÃ¡s que Miseria",
  // Scourge Hook Perks
  "Gancho Atormentado: Resonancia del Dolor",
  "Gancho Atormentado: Heridas que Lloran",
  "Gancho Atormentado: Regalo del Dolor",
  "Gancho Atormentado: Monstruoso Santuario",
  "Gancho Atormentado: InundaciÃ³n de Furia",
  // Perks de InformaciÃ³n / Rastreo
  "Barbacoa y Chile",
  "Perseguidor Letal",
  "NingÃºn Lugar donde Esconderse",
  "RevelaciÃ³n de la Oscuridad",
  "Discordancia",
  "Susurros",
  "Depredador",
  "Sabueso",
  "Acechador de Ciervos",
  "Imperativo Territorial",
  "Amante de los Objetos (Hoarder)",
  "Rencor",
  "Oscura DevociÃ³n",
  "Llamada de una Enfermera",
  // Perks de Control de Generadores
  "IntervenciÃ³n Corrupta",
  "ExplosiÃ³n",
  "Llamada de Salmuera",
  "Sobrecarga",
  "OposiciÃ³n",
  "Deadlock",
  "Interruptor del Hombre Muerto",
  "Sacudida (Surge/Jolt)",
  "TÃ©cnico",
  "Pop Goes the Weasel",
  "Limitaciones Crueles",
  "BaterÃ­as Incluidas",
  // Perks de PersecuciÃ³n
  "Lo Mejor para el Final",
  "Golpe de Gracia",
  "Bamboozle",
  "Fuerza Brutal",
  "Resistente (Enduring)",
  "Bestia de Presa",
  "AgitaciÃ³n",
  "DisoluciÃ³n",
  "Brutalidad RÃ¡pida",
  "Arrogancia Oscura",
  // Perks de PresiÃ³n / Castigo
  "Miedo Infeccioso",
  "Ecos de Sangre",
  "Luz Moribunda",
  "GuardiÃ¡n de Sangre",
  "Recordarme",
  "Penitencia Forzada",
  "Duda Forzada",
  "Vigilancia",
  "Dominancia",
  // Perks Generales ClÃ¡sicas
  "Mano de Hierro",
  "Insidioso",
  "Perturbador",
  "Amargura Murmurante",
  "Devorador de EnergÃ­a",
  "Knock Out",
  "Territorial Imperative"
];

const listaDiv = document.getElementById("lista");
const textoInput = document.getElementById("texto");
const excluir1Select = document.getElementById("excluir1");
const excluir2Select = document.getElementById("excluir2");

function guardarFirebase(){
  set(ref(db,"ruleta/premios"), premios);
}

function actualizarSelects(){
  // Actualizar ambos selects de exclusiÃ³n
  [excluir1Select, excluir2Select].forEach(select => {
    select.innerHTML = '<option value="">-- Ninguno --</option>';
    premios.forEach((p, i) => {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = p;
      select.appendChild(option);
    });
  });
}

function renderLista(){
  listaDiv.innerHTML="";
  premios.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML = `
      <span>${p}</span>
      <button class="delete" onclick="eliminar(${i})">âŒ</button>
    `;
    listaDiv.appendChild(d);
  });
  actualizarSelects();
}

window.agregar = () => {
  const t = textoInput.value.trim();
  if(!t) return;
  premios.push(t);
  textoInput.value="";
  renderLista();
  guardarFirebase();
};

window.eliminar = (index) => {
  premios.splice(index,1);
  renderLista();
  guardarFirebase();
};

window.limpiar = () => {
  premios = [];
  renderLista();
  guardarFirebase();
};

window.girar = () => {
  if(premios.length === 0){
    alert("âš ï¸ Agrega items a la ruleta primero");
    return;
  }

  // Seleccionar ganador aleatorio
  const ganador = premios[Math.floor(Math.random() * premios.length)];

  // Escribir en Firebase
  set(ref(db,"ruleta"), {
    premios: premios,
    resultado: ganador
  });
};

window.girarConExclusiones = () => {
  if(premios.length === 0){
    alert("âš ï¸ Agrega items a la ruleta primero");
    return;
  }

  const excluido1 = excluir1Select.value;
  const excluido2 = excluir2Select.value;
  
  // Validar que no sean el mismo item
  if(excluido1 !== "" && excluido1 === excluido2){
    alert("âš ï¸ Los dos items excluidos no pueden ser el mismo");
    return;
  }

  // Crear array de Ã­ndices vÃ¡lidos (sin los excluidos)
  const indicesValidos = [];
  premios.forEach((p, i) => {
    if(i.toString() !== excluido1 && i.toString() !== excluido2){
      indicesValidos.push(i);
    }
  });

  // Validar que queden al menos 1 item vÃ¡lido
  if(indicesValidos.length === 0){
    alert("âš ï¸ Debes dejar al menos un item sin excluir");
    return;
  }

  // Seleccionar ganador aleatorio de los items vÃ¡lidos
  const indiceGanador = indicesValidos[Math.floor(Math.random() * indicesValidos.length)];
  const ganador = premios[indiceGanador];

  // Escribir en Firebase
  set(ref(db,"ruleta"), {
    premios: premios,
    resultado: ganador
  });

  // Opcional: resetear los selects
  excluir1Select.value = "";
  excluir2Select.value = "";
};

window.cargarKillersOriginales = () => {
  premios = [...killersOriginales];
  renderLista();
  guardarFirebase();
};

window.cargarKillersLicenciados = () => {
  premios = [...killersLicenciados];
  renderLista();
  guardarFirebase();
};

window.cargarKillersComunidad = () => {
  premios = [...killersComunidad];
  renderLista();
  guardarFirebase();
};

window.cargarTodos = () => {
  premios = [...killersOriginales, ...killersLicenciados, ...killersComunidad];
  renderLista();
  guardarFirebase();
};

window.cargarPerks = () => {
  premios = [...perks];
  renderLista();
  guardarFirebase();
};

onValue(ref(db,"ruleta/premios"), snap=>{
  if(snap.exists()){
    premios = snap.val();
    renderLista();
  }
});
</script>

</body>
</html>